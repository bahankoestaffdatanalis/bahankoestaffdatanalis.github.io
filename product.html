<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Data Table</title>
    
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/css/jquery.dataTables.min.css">
    
    <!-- Select2 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">
    
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 10px;
            background-color: #f5f5f5;
            margin: 0;
            font-size: 13px;
        }
        
        .container {
            max-width: 100%;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 15px;
            font-size: 22px;
        }
        
        #loadingMsg {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        table.dataTable {
            width: 100% !important;
            font-size: 12px;
        }
        
        table.dataTable thead th {
            padding: 8px 10px;
            font-size: 12px;
        }
        
        table.dataTable tbody td {
            padding: 6px 10px;
            font-size: 12px;
        }
        
        .dataTables_wrapper {
            padding: 10px 0;
            font-size: 12px;
        }
        
        .dataTables_filter input,
        .dataTables_length select {
            font-size: 12px;
        }
        
        /* Style for column search inputs */
        .column-search {
            width: 100%;
            padding: 4px 6px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 11px;
        }
        
        .column-search:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        thead tr:nth-child(2) th {
            padding: 4px;
        }
        
        /* Style for Select2 */
        .select2-container {
            min-width: 180px;
            font-size: 12px;
        }
        
        .select2-container .select2-selection--single {
            height: 34px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .select2-container .select2-selection--single .select2-selection__rendered {
            line-height: 34px;
            padding-left: 10px;
            font-size: 12px;
        }
        
        .select2-container .select2-selection--single .select2-selection__arrow {
            height: 32px;
        }
        
        .select2-results__option {
            font-size: 12px;
        }
        
        #clearFilters:hover {
            background-color: #d32f2f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Product Data</h1>
        <div id="loadingMsg">Loading data...</div>
        
        <div id="filters" style="display:none; margin-bottom: 15px;">
            <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: flex-end;">
                <div>
                    <label for="divisiFilter" style="display: block; margin-bottom: 4px; font-weight: bold; font-size: 12px;">Divisi:</label>
                    <select id="divisiFilter" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; min-width: 180px; font-size: 12px;">
                        <option value="">Semua Divisi</option>
                    </select>
                </div>
                <div>
                    <label for="kategoriFilter" style="display: block; margin-bottom: 4px; font-weight: bold; font-size: 12px;">Kategori:</label>
                    <select id="kategoriFilter" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; min-width: 180px; font-size: 12px;">
                        <option value="">Semua Kategori</option>
                    </select>
                </div>
                <div>
                    <label for="supplierFilter" style="display: block; margin-bottom: 4px; font-weight: bold; font-size: 12px;">Supplier:</label>
                    <select id="supplierFilter" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; min-width: 180px; font-size: 12px;">
                        <option value="">Semua Supplier</option>
                    </select>
                </div>
                <div>
                    <button id="clearFilters" style="padding: 6px 16px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: background-color 0.3s; font-size: 12px;">
                        Hapus Semua Filter
                    </button>
                </div>
            </div>
        </div>
        
        <table id="productTable" class="display" style="display:none; width:100%">
            <thead>
                <tr>
                    <th>Barcode</th>
                    <th>Nama Produk</th>
                    <th>H Beli</th>
                    <th>H Jual</th>
                    <th>Margin</th>
                    <th>Divisi</th>
                    <th>Departemen</th>
                    <th>Kategori</th>
                    <th>Subkategori</th>
                    <th>Supplier</th>
                    <th>Qty Terjual</th>
                    <th>Qty Terjual/Bulan</th>
                    <th>Qty Terjual/Hari</th>
                    <th>Stok</th>
                    <th>ITO</th>
                </tr>
                <tr>
                    <th><input type="text" class="column-search" placeholder="Cari barcode..." /></th>
                    <th><input type="text" class="column-search" placeholder="Cari nama produk..." /></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
    </div>

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <!-- DataTables JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"></script>
    
    <!-- Select2 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

    <script>
        // Fetch data from API
        fetch('https://api.sheetbest.com/sheets/aba461f9-f680-4184-96a7-1a1405627cac')
            .then(response => response.json())
            .then(data => {
                console.log('Data received:', data);
                
                // Hide loading message
                document.getElementById('loadingMsg').style.display = 'none';
                
                // Show filters and table
                document.getElementById('filters').style.display = 'block';
                document.getElementById('productTable').style.display = 'table';
                
                // Get unique values for filters
                const divisiSet = new Set();
                const kategoriSet = new Set();
                const supplierSet = new Set();
                
                data.forEach(item => {
                    if (item.DIVISI) divisiSet.add(item.DIVISI);
                    if (item.KATEGORI) kategoriSet.add(item.KATEGORI);
                    if (item.SUPPLIER) supplierSet.add(item.SUPPLIER);
                });
                
                // Populate filter dropdowns
                const divisiFilter = document.getElementById('divisiFilter');
                const kategoriFilter = document.getElementById('kategoriFilter');
                const supplierFilter = document.getElementById('supplierFilter');
                
                Array.from(divisiSet).sort().forEach(divisi => {
                    const option = document.createElement('option');
                    option.value = divisi;
                    option.textContent = divisi;
                    divisiFilter.appendChild(option);
                });
                
                Array.from(kategoriSet).sort().forEach(kategori => {
                    const option = document.createElement('option');
                    option.value = kategori;
                    option.textContent = kategori;
                    kategoriFilter.appendChild(option);
                });
                
                Array.from(supplierSet).sort().forEach(supplier => {
                    const option = document.createElement('option');
                    option.value = supplier;
                    option.textContent = supplier;
                    supplierFilter.appendChild(option);
                });
                
                // Initialize Select2 on filter dropdowns
                $('#divisiFilter').select2({
                    placeholder: 'Semua Divisi',
                    allowClear: true
                });
                
                $('#kategoriFilter').select2({
                    placeholder: 'Semua Kategori',
                    allowClear: true
                });
                
                $('#supplierFilter').select2({
                    placeholder: 'Semua Supplier',
                    allowClear: true
                });
                
                // Initialize DataTable with the fetched data
                const table = $('#productTable').DataTable({
                    data: data,
                    columns: [
                        { data: 'BARCODE' },
                        { data: 'NAMA PRODUK' },
                        { data: 'HBELI' },
                        { data: 'HJUAL' },
                        { data: 'MARGIN' },
                        { data: 'DIVISI' },
                        { data: 'DEPARTEMEN' },
                        { data: 'KATEGORI' },
                        { data: 'SUBKATEGORI' },
                        { data: 'SUPPLIER' },
                        { data: 'QTY TERJUAL' },
                        { data: 'QTY TERJUAL PERBULAN' },
                        { data: 'QTY TERJUAL PERHARI' },
                        { data: 'STOK' },
                        { data: 'ITO' }
                    ],
                    pageLength: 25,
                    order: [[0, 'asc']],
                    responsive: true,
                    language: {
                        search: "Cari:",
                        lengthMenu: "Tampilkan _MENU_ data per halaman",
                        info: "Menampilkan _START_ sampai _END_ dari _TOTAL_ data",
                        infoEmpty: "Menampilkan 0 sampai 0 dari 0 data",
                        infoFiltered: "(difilter dari _MAX_ total data)",
                        paginate: {
                            first: "Pertama",
                            last: "Terakhir",
                            next: "Selanjutnya",
                            previous: "Sebelumnya"
                        },
                        zeroRecords: "Tidak ada data yang ditemukan"
                    }
                });
                
                // Add column search functionality for Barcode (column 0)
                $('#productTable thead tr:nth-child(2) th:eq(0) input').on('keyup change', function() {
                    table.column(0).search(this.value).draw();
                });
                
                // Add column search functionality for Nama Produk (column 1)
                $('#productTable thead tr:nth-child(2) th:eq(1) input').on('keyup change', function() {
                    table.column(1).search(this.value).draw();
                });
                
                // Add filter event listeners for Select2 dropdowns
                $('#divisiFilter').on('change', function() {
                    table.column(5).search(this.value).draw();
                });
                
                $('#kategoriFilter').on('change', function() {
                    table.column(7).search(this.value).draw();
                });
                
                $('#supplierFilter').on('change', function() {
                    table.column(9).search(this.value).draw();
                });
                
                // Clear all filters button
                $('#clearFilters').on('click', function() {
                    // Clear Select2 dropdowns
                    $('#divisiFilter').val('').trigger('change');
                    $('#kategoriFilter').val('').trigger('change');
                    $('#supplierFilter').val('').trigger('change');
                    
                    // Clear column search inputs
                    $('#productTable thead tr:nth-child(2) th input').val('');
                    
                    // Clear DataTable search
                    table.search('').columns().search('').draw();
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                document.getElementById('loadingMsg').innerHTML = 
                    '<p style="color: red;">Error loading data. Please check the console for details.</p>';
            });
    </script>
</body>
</html>